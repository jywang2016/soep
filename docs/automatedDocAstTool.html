

<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Automated Documentation/AST Support Tool &#8212; Spawn of EnergyPlus</title>
    <link rel="stylesheet" href="_static/bootstrap-sphinx.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="_static/basic.css" />
    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="_static/bootstrap.css" />
    <link rel="stylesheet" type="text/css" href="_static/bootstrap-theme.css" />
    <link rel="stylesheet" type="text/css" href="_static/bootstrap_custom.css" />
    <link rel="stylesheet" type="text/css" href="_static/custom.css" />
    <link rel="stylesheet" type="text/css" href="_static/custom-sphinx.css" />
    <link rel="stylesheet" type="text/css" href="_static/bootstrap.css" />
    <link rel="stylesheet" type="text/css" href="_static/bootstrap-theme.css" />
    <link rel="stylesheet" type="text/css" href="_static/bootstrap_custom.css" />
    <link rel="stylesheet" type="text/css" href="_static/custom.css" />
    <link rel="stylesheet" type="text/css" href="_static/custom-sphinx.css" />
    <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script async="async" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/javascript" src="_static/js/jquery-1.11.0.min.js"></script>
    <script type="text/javascript" src="_static/js/jquery-fix.js"></script>
    <script type="text/javascript" src="_static/bootstrap-3.3.7/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="_static/bootstrap-sphinx.js"></script>
    <link rel="shortcut icon" href="_static/lbl-icon.ico"/>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
<meta charset='utf-8'>
<meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1'>
<meta name="apple-mobile-web-app-capable" content="yes">

  </head><body>

  <div id="navbar" class="navbar navbar-default ">
    <div class="container-fluid">
      <div class="navbar-header">
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="index.html"><img src="_static/spawn_icon_darkbluetxhighres.png">
           </a>
        <span class="navbar-text navbar-version pull-left"><b></b></span>
      </div>

        <div class="collapse navbar-collapse nav-collapse">
          <ul class="nav navbar-nav">
            
                <li><a href="index.html">Index</a></li>
            
            
              <li class="dropdown globaltoc-container">
  <a role="button"
     id="dLabelGlobalToc"
     data-toggle="dropdown"
     data-target="#"
     href="index.html">Site <b class="caret"></b></a>
  <ul class="dropdown-menu globaltoc"
      role="menu"
      aria-labelledby="dLabelGlobalToc"><ul>
<li class="toctree-l1"><a class="reference internal" href="preample.html">1. Preample</a><ul>
<li class="toctree-l2"><a class="reference internal" href="preample.html#purpose-of-the-document">1.1. Purpose of the Document</a></li>
<li class="toctree-l2"><a class="reference internal" href="preample.html#contributors">1.2. Contributors</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="conventions.html">2. Conventions</a></li>
<li class="toctree-l1"><a class="reference internal" href="useCases.html">3. Use Cases</a><ul>
<li class="toctree-l2"><a class="reference internal" href="useCases.html#openstudio-integration">3.1. OpenStudio Integration</a></li>
<li class="toctree-l2"><a class="reference internal" href="useCases.html#measures">3.2. Measures</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="requirements.html">4. Requirements</a><ul>
<li class="toctree-l2"><a class="reference internal" href="requirements.html#openstudio-integration">4.1. OpenStudio integration</a></li>
<li class="toctree-l2"><a class="reference internal" href="requirements.html#mathematics">4.2. Mathematics</a></li>
<li class="toctree-l2"><a class="reference internal" href="requirements.html#fmu-requirements">4.3. FMU Requirements</a></li>
<li class="toctree-l2"><a class="reference internal" href="requirements.html#qss-implementation">4.4. QSS Implementation</a></li>
<li class="toctree-l2"><a class="reference internal" href="requirements.html#master-algorithm">4.5. Master Algorithm</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="softwareArchitecture.html">5. Software Architecture</a><ul>
<li class="toctree-l2"><a class="reference internal" href="softwareArchitecture.html#overall-software-architecture">5.1. Overall software architecture</a></li>
<li class="toctree-l2"><a class="reference internal" href="softwareArchitecture.html#coupling-of-energyplus-with-modelica">5.2. Coupling of EnergyPlus with Modelica</a></li>
<li class="toctree-l2"><a class="reference internal" href="softwareArchitecture.html#integration-of-qss-solver-with-jmodelica">5.3. Integration of QSS solver with JModelica</a></li>
<li class="toctree-l2"><a class="reference internal" href="softwareArchitecture.html#integration-with-openstudio">5.4. Integration with OpenStudio</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="numericalMethods.html">6. Numerical Methods of the Master Algorithm</a><ul>
<li class="toctree-l2"><a class="reference internal" href="numericalMethods.html#time-integration">6.1. Time Integration</a></li>
<li class="toctree-l2"><a class="reference internal" href="numericalMethods.html#algebraic-loops">6.2. Algebraic Loops</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="api.html">7. Application Programming Interface</a><ul>
<li class="toctree-l2"><a class="reference internal" href="api.html#generating-openstudio-models">7.1. Generating OpenStudio Models</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="benchmarks.html">8. Benchmarks</a></li>
<li class="toctree-l1"><a class="reference internal" href="acknowledgments.html">9. Acknowledgments</a></li>
<li class="toctree-l1"><a class="reference internal" href="glossary.html">10. Glossary</a></li>
<li class="toctree-l1"><a class="reference internal" href="zreferences.html">11. References</a></li>
</ul>
</ul>
</li>
              
                <li class="dropdown">
  <a role="button"
     id="dLabelLocalToc"
     data-toggle="dropdown"
     data-target="#"
     href="#">Page <b class="caret"></b></a>
  <ul class="dropdown-menu localtoc"
      role="menu"
      aria-labelledby="dLabelLocalToc"><ul>
<li><a class="reference internal" href="#">Automated Documentation/AST Support Tool</a><ul>
<li><a class="reference internal" href="#background">Background</a></li>
<li><a class="reference internal" href="#requirements">Requirements</a></li>
<li><a class="reference internal" href="#literature-review">Literature review</a></li>
<li><a class="reference internal" href="#implementation">Implementation</a></li>
</ul>
</li>
</ul>
</ul>
</li>
              
            
            
              
                
              
            
            
            
            
          </ul>

<!--
          
            
<form class="navbar-form navbar-right" action="search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
          
-->
        </div>
    </div>
  </div>

<div class="container">
  <div class="row">
    <div class="col-md-12 content">
      
  <div class="section" id="automated-documentation-ast-support-tool">
<h1>Automated Documentation/AST Support Tool<a class="headerlink" href="#automated-documentation-ast-support-tool" title="Permalink to this headline">¶</a></h1>
<p>This section describes how to
generate automated SOEP documentation and abstract syntax trees from
the Modelica Buildings Library (MBL), or from other Modelica libraries that
users may use with SOEP.
The goal is to expose the <a class="reference external" href="https://en.wikipedia.org/wiki/Abstract_syntax_tree">abstract
syntax tree (AST)</a> of the
MBL, and make it available to other tools via one or several json files.
These json files can then be used by OpenStudio to
discover available models and their parameters and other metadata for use
from the OpenStudio interface for SOEP.</p>
<div class="section" id="background">
<h2>Background<a class="headerlink" href="#background" title="Permalink to this headline">¶</a></h2>
<p>Modelica source code contains a lot of meta-data in addition to the
mathematical model itself. An annotation system exists within Modelica and
custom annotations can be written to pass data to tools. Annotations were
designed to be an extensible mechanism for capturing meta-data related to a
model including html-documentation, vendor-specific data, and graphical
annotations. Parameters, variables, equations, and models can contain
documentation strings and annotations. Furthermore, packages can be documented
and the display order of sub-packages, models, classes, functions, connectors
and other objects can be specified. Modelica libraries have a hierarchical
structure consisting mainly of packages which contain models and other objects
as well as sub-packages. Models themselves can be composed of multiple, possibly
replaceable, components. Much of this information will be required by the
OpenStudio tool in order to understand which component models are available,
where they reside in the library’s package structure which determines their fully
qualified name, what parameters they have, how they can be configured, how to
display them, and what other meta-data are available, such as documentation
strings and type of connectors that can be connected with each other.</p>
<p>This section is concerned about making the AST of Modelica source files,
including the metadata mentioned above, available to OpenStudio. We
will specifically focus on the Modelica Buildings Library (MBL), but other
Modelica libraries can be used as well.</p>
<p>The intent of the AST representation is <em>primarily</em> to be consumed by the
OpenStudio application for identification of models, model documentation, model
connecting points, inputs/outputs, and parameters and related meta-data.</p>
<p>An OpenStudio application will consume some or all of the above
information, use it to provide an interface to the user, and ultimately write
out a Modelica file which connects the various library components, configures
various components, and assigns values to parameters.</p>
<p>To create models, information from other libraries, most notably, the Modelica
Standard Library (MSL), may need to be made available. Typical
applications and examples from the MBL use
component models from both the MSL and MBL. There is also interest in being
able to support additional third party libraries.</p>
</div>
<div class="section" id="requirements">
<h2>Requirements<a class="headerlink" href="#requirements" title="Permalink to this headline">¶</a></h2>
<p>This section will describe the requirements of a batch-process program
that will transform any
Modelica input file or library into a json file. The json file shall contain:</p>
<ul class="simple">
<li>identification of which models, classes, connectors, functions, etc. exist</li>
<li>identification of the relative hierarchy of the above components within the
package structure of the library</li>
<li>for each package,<ul>
<li>what models are available</li>
<li>what connection “ports” are available</li>
<li>for fluid ports, which ports carry the same fluid
(so that media assignments can be propagated through a circuit) <a class="footnote-reference" href="#fn-flu" id="id1">[1]</a></li>
<li>what control inputs/outputs are available</li>
<li>what parameters are available</li>
<li>what configuration management options exist (i.e., replaceable components
and packages and which parameters belong to which component)</li>
<li>meta-data and attributes for all the above such as graphics
annotations, vendor annotations, html documentation, etc.</li>
</ul>
</li>
</ul>
<p>For integration with OpenStudio, the tool should reduce dependencies
that complicate the distribution to users.</p>
<p>The tool shall also have options to exclude certain packages. For example,
OpenStudio may give access to the package <cite>Modelica.Blocks</cite>
but not to <cite>Modelica.Magnetic</cite>.</p>
<p>The tool shall also allow to perform a “diff” (i.e., logical
differences) between two generated json files.
The purpose of the diff tool would be to detect non-trivial
differences between two generated json files that hold the AST of a Modelica
library and report those changes. The content of the
“difference” file would show the differences between the two
input manifests.</p>
<p>The diff tool would be of use in particular when new versions of the
MBL are released and the OpenStudio team would like to check if there are
non-trivial changes they need to integrate.</p>
<p>The following two lists attempt to list examples of changes that
cannot be ignored as well as changes that can be ignored.</p>
<p><em>Significant Changes (backward-incompatible)</em></p>
<ul class="simple">
<li>changes to names of any public package, model, block, function, record, as well
as public constants, parameters, variables, connectors, or subcomponents</li>
<li>addition of any public parameters that has no default value,
variables that have no equation (in a partial model), connectors (except for output connectors),
or subcomponents that require changes to models that extend or instantiate these components</li>
<li>addition/subtraction of packages/models/blocks/functions meant to be consumed
by OpenStudio</li>
<li>removing of any public constant, parameter, or class (model, block, function, type etc.)</li>
<li>moving a class between packages (i.e., changing the path)</li>
</ul>
<p><em>Changes that may be ignored (backward-compatible)</em></p>
<ul class="simple">
<li>changes in style without changes in meaning (addition or removal of
whitespace, reordering within a section)</li>
<li>changes to documentation strings</li>
<li>changes to text in embedded HTML documentation</li>
<li>changes to revision notes</li>
<li>changes to graphical annotations</li>
<li>changes in ordering of models/blocks/functions within a package</li>
<li>changes to <cite>protected</cite> sections of code</li>
<li>changes to <cite>equation</cite> or <cite>algorithm</cite> sections of code</li>
<li>changes to some models/blocks/functions may be completely ignored if, by
convention, we deem certain paths as “not directly consumable” by OpenStudio.
For example, we may wish to not consume classes in the packages <cite>BaseClasses</cite>,
<cite>Examples</cite> and <cite>Validations</cite>.</li>
</ul>
<p>To summarize, the creation of or changes to the “public API” (public
parameters, variables, subcomponents, connectors) of models, blocks, or
functions must be compared for change detection. Documentation (html)/
documentation strings/graphics annotations will not affect the model interface
or semantics. Changes to protected properties or equations will not affect
the interface (but may affect the actual numeric output quantities).</p>
</div>
<div class="section" id="literature-review">
<h2>Literature review<a class="headerlink" href="#literature-review" title="Permalink to this headline">¶</a></h2>
<p>There have been several attempts to represent or use XML in relation to
Modelica in the past (<a class="reference internal" href="zreferences.html#landin2014" id="id2">[Lan14]</a>, <a class="reference internal" href="zreferences.html#fritzson2003g" id="id3">[Fri03]</a>,
<a class="reference internal" href="zreferences.html#pop2003" id="id4">[PF03]</a>, <a class="reference internal" href="zreferences.html#pop2005" id="id5">[PSAssmannF05]</a>, and <a class="reference internal" href="zreferences.html#reisenbichler2006" id="id6">[RKH+06]</a>).</p>
<p>In particular, Landin <a class="reference internal" href="zreferences.html#landin2014" id="id7">[Lan14]</a> did work with Modelon using JModelica to export XML for
the purpose of model exchange, which is similar to our use case.
Unfortunately, this work deals only with “flattened” models – Modelica models
that have been instantiated with all of the hierarchy removed. For our use
case, the hierarchy must be preserved so that the OpenStudio team can
build a new model through instantiation of models from the MBL.
For this purpose, JModelica also provides access to the the source AST and instance AST
(see the <a class="reference external" href="http://www.jmodelica.org/api-docs/usersguide/JModelicaUsersGuide-1.17.0.pdf">JModelica user guide</a>).</p>
<p>Reisenbichler <a class="reference internal" href="zreferences.html#reisenbichler2006" id="id8">[RKH+06]</a> motivates the usage of XML in association with
Modelica without getting into specifics.
The remaining work by Pop and Fritzson
is thus the only comprehensive work on an XML representation of Modelica
<em>source</em> AST that appears in the literature
(<a class="reference internal" href="zreferences.html#pop2003" id="id9">[PF03]</a>, <a class="reference internal" href="zreferences.html#pop2005" id="id10">[PSAssmannF05]</a>, and <a class="reference internal" href="zreferences.html#fritzson2003g" id="id11">[Fri03]</a>).
The purpose of the XML work by Pop
and Fritzson was to create a complete XML representation of the entire Modelica
source.</p>
<p>ANTLR (ANother Tool for Language Recognition)
is a parser generator for reading, processing, executing, or
translating structured text or binary files.
It is widely used to build languages, tools, and frameworks.
From a grammar, ANTLR generates a parser that can build parse trees and
also generates a listener interface (or visitor) that makes it easy
to respond to the recognition of phrases of interest.
For ANTLR, a Modelica grammar is available at
<a class="reference external" href="https://github.com/antlr/grammars-v4/blob/master/modelica/modelica.g4">https://github.com/antlr/grammars-v4/blob/master/modelica/modelica.g4</a>.</p>
</div>
<div class="section" id="implementation">
<h2>Implementation<a class="headerlink" href="#implementation" title="Permalink to this headline">¶</a></h2>
<p>Work started on the implementation of a modelica-json translator.
The development page is <a class="reference external" href="https://github.com/lbl-srg/modelica-json">https://github.com/lbl-srg/modelica-json</a></p>
<p>To illustrate the translation, consider the following simple model:</p>
<div class="highlight-modelica notranslate"><div class="highlight"><pre><span></span><span class="kr">within</span> <span class="nn">FromModelica</span><span class="p">;</span>
<span class="kr">block</span> <span class="nc">BlockWithBlock1</span> <span class="s2">&quot;A block that instantiates another public and protected block&quot;</span>
  <span class="n">Block1</span> <span class="n">bloPub</span> <span class="s2">&quot;A public block&quot;</span><span class="p">;</span>
<span class="kr">protected</span>
  <span class="n">Block1</span> <span class="n">bloPro</span> <span class="s2">&quot;A protected block&quot;</span><span class="p">;</span>
<span class="kr">end</span> <span class="nc">BlockWithBlock1</span><span class="p">;</span>
</pre></div>
</div>
<p>When parsed to json, the output is:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="p">[</span>
  <span class="p">{</span>
    <span class="s2">&quot;modelicaFile&quot;</span><span class="o">:</span> <span class="s2">&quot;./BlockWithBlock1.mo&quot;</span><span class="p">,</span>
    <span class="s2">&quot;within&quot;</span><span class="o">:</span> <span class="s2">&quot;FromModelica&quot;</span><span class="p">,</span>
    <span class="s2">&quot;topClassName&quot;</span><span class="o">:</span> <span class="s2">&quot;FromModelica.BlockWithBlock1&quot;</span><span class="p">,</span>
    <span class="s2">&quot;comment&quot;</span><span class="o">:</span> <span class="s2">&quot;A block that instantiates another public and protected block&quot;</span><span class="p">,</span>
    <span class="s2">&quot;public&quot;</span><span class="o">:</span> <span class="p">{</span>
      <span class="s2">&quot;models&quot;</span><span class="o">:</span> <span class="p">[</span>
        <span class="p">{</span>
          <span class="s2">&quot;className&quot;</span><span class="o">:</span> <span class="s2">&quot;Block1&quot;</span><span class="p">,</span>
          <span class="s2">&quot;name&quot;</span><span class="o">:</span> <span class="s2">&quot;bloPub&quot;</span><span class="p">,</span>
          <span class="s2">&quot;comment&quot;</span><span class="o">:</span> <span class="s2">&quot;A public block&quot;</span>
        <span class="p">}</span>
      <span class="p">]</span>
    <span class="p">},</span>
    <span class="s2">&quot;protected&quot;</span><span class="o">:</span> <span class="p">{</span>
      <span class="s2">&quot;models&quot;</span><span class="o">:</span> <span class="p">[</span>
        <span class="p">{</span>
          <span class="s2">&quot;className&quot;</span><span class="o">:</span> <span class="s2">&quot;Block1&quot;</span><span class="p">,</span>
          <span class="s2">&quot;name&quot;</span><span class="o">:</span> <span class="s2">&quot;bloPro&quot;</span><span class="p">,</span>
          <span class="s2">&quot;comment&quot;</span><span class="o">:</span> <span class="s2">&quot;A protected block&quot;</span>
        <span class="p">}</span>
      <span class="p">]</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">]</span>
</pre></div>
</div>
<p class="rubric">Footnotes</p>
<table class="docutils footnote" frame="void" id="fn-flu" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id1">[1]</a></td><td>We anticipate that the MBL will be redesigned so that users no longer
need to assign media.</td></tr>
</tbody>
</table>
</div>
</div>


    </div>
      
  </div>
</div>
  
<footer class="footer">
  <div class="container">
    <p class="pull-right">
      <a href="#">Back to top</a>
      
        <br/>
        
      
    </p>
    <p>
        &copy; Copyright (c) All rights reserved.<br/>
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.8.2.<br/>
    </p>
  </div>
</footer>

  </body>
</html>